% HMM with pimh inference, compressed output

% Define the data
data_hmm = [0.9 0.8 0.7 0.0 -0.025 -5.0 -2.0 -0.1 0.0 0.13 0.45 6 0.2 0.3 -1 -1]';

% Run PIMH inference
samples_hmm = infer('hmm',data_hmm,'pimh','n_particles',1e4,'n_iter',20);

% Calculate empirical probabilities
p_hmm = results_binning(samples_hmm,'x',[],true,[],[],[1 2 3])';

% Predefined ground truth
p_hmm_truth = [0.377510329270661,0.309531763819114,0.312957906910225;
                       0.0414378861264862,0.406623078612501,0.551939035261013;
                       0.0536324337803479,0.254680440661969,0.691687125557683;
                       0.0456534970142020,0.230082297435319,0.724264205550479;
                       0.105685915918161,0.120813663181357,0.773500420900481;
                       0.0711054851992244,0.172144123412619,0.756750391388157;
                       0.929464549092631,0.000123965467080903,0.0704114854402879;
                       0.457535923680403,0.0456331420588863,0.496830934260711;
                       0.0921655338249388,0.217034056521611,0.690800409653451;
                       0.101544091004343,0.136235592179542,0.762220316816116;
                       0.0986827336089095,0.157463653483870,0.743853612907220;
                       0.178493790579279,0.219544259159816,0.601961950260906;
                       6.25964028429687e-06,0.984915586803889,0.0150781535558268;
                       0.112921375903980,0.167067325247519,0.720011298848501;
                       0.0556364838062831,0.184851043327823,0.759512472865894;
                       0.201502367616899,0.0473264197254615,0.751171212657639;
                       0.254553838741815,0.0611172011550286,0.684328960103157];

% Distance metric                   
p_hmm_distance = sqrt(sum(sum((p_hmm-p_hmm_truth).^2))/(3*16));

disp(['HMM scaled distance to truth ' num2str(p_hmm_distance)]);
